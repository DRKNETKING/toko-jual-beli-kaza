import React, { useState, useCallback } from 'react';
// Tidak ada impor 'useEffect' yang diperlukan di sini, sehingga dihapus untuk kode yang lebih bersih.

// --- Komponen Utama Aplikasi ---
const App = () => {
    // State untuk mengontrol tampilan section (Home/About Us)
    const [activeSection, setActiveSection] = useState('home');
    // State untuk menyimpan gambar yang sudah di-generate per produk
    const [productImages, setProductImages] = useState({});
    // State untuk mengelola UI loading
    const [loadingProductId, setLoadingProductId] = useState(null);
    // State untuk menangani pesan error
    const [error, setError] = useState(null);
    // State untuk notifikasi pop-up
    const [notification, setNotification] = useState('');

    // Nomor Kontak WA (085216991236, diformat untuk link internasional)
    const waNumber = '085216991236';
    // Link WA dengan format 62
    const waLink = `https://wa.me/62${waNumber.substring(1)}`;

    // Konfigurasi API - Kosongkan jika menggunakan Canvas
    const apiKey = ""; 
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`;

    // Detail Produk KAZA (Termasuk prompt spesifik untuk Image Generation)
    const products = [
        { 
            id: 1, 
            name: "Kemeja KAZA Klasik Premium", 
            price: "Rp 349.000", 
            prompt: "A photorealistic, highly detailed image of a crisp white linen long-sleeve shirt, folded neatly, against a minimalist cream background. Elegant, high-fashion studio quality. Focus on texture and simple design.",
            defaultText: "Kemeja Elegan",
        },
        { 
            id: 2, 
            name: "T-Shirt KAZA Beruang", 
            price: "Rp 199.000", 
            prompt: "A high-quality 3D render of a black oversized T-shirt with a minimalist, stylized Kaza Bear mascot logo printed on the chest. The bear mascot is cute but cool. Modern studio lighting, isolated on a light gray background.",
            defaultText: "T-Shirt Beruang",
        },
        { 
            id: 3, 
            name: "Dress Simple Mid-Length", 
            price: "Rp 480.000", 
            prompt: "A cinematic, soft-focus photo of a simple, flowing midi dress in muted terracotta color, hanging gracefully in a sunlit fashion studio. Emphasize the textile's light texture and relaxed silhouette. High-end fashion editorial style.",
            defaultText: "Dress Minimalis",
        },
        { 
            id: 4, 
            name: "Topi Snapback KAZA Premium", 
            price: "Rp 120.000", 
            prompt: "An extreme close-up, sharp photo of a black leather snapback cap. The KAZA logo is subtly embroidered in deep crimson thread. Studio product photography, dark moody background, high contrast.",
            defaultText: "Snapback KAZA",
        },
    ];

    // Fungsi utilitas untuk konversi Base64 ke URL (sangat penting untuk Imagen)
    const base64ToUrl = (base64) => `data:image/png;base64,${base64}`;

    // Fungsi untuk menampilkan notifikasi pop-up (menggantikan alert)
    const showNotification = useCallback((message) => {
        setNotification(message);
        setTimeout(() => setNotification(''), 3000); // Notifikasi hilang setelah 3 detik
    }, []);

    /**
     * Fungsi API Call dengan Exponential Backoff untuk menangani throttling atau kegagalan sementara.
     * Menggunakan useCallback untuk stabilitas fungsi.
     */
    const generateProductImage = useCallback(async (productId, prompt, maxRetries = 5) => {
        setLoadingProductId(productId);
        setError(null);
        
        const payload = { 
            instances: [{ prompt: prompt }], 
            parameters: { "sampleCount": 1 } 
        };

        for (let attempt = 0; attempt < maxRetries; attempt++) {
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    // Jika ada error HTTP, lempar error untuk memicu retry atau final failure
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                const base64Data = result?.predictions?.[0]?.bytesBase64Encoded;

                if (!base64Data) {
                    throw new Error("Gagal mendapatkan data gambar dari API.");
                }

                // Update state gambar produk
                setProductImages(prev => ({
                    ...prev,
                    [productId]: base64ToUrl(base64Data)
                }));
                setLoadingProductId(null);
                return; // Berhasil, keluar dari loop
                
            } catch (err) {
                if (attempt === maxRetries - 1) {
                    // Gagal setelah semua percobaan
                    console.error("Gagal generate gambar setelah beberapa kali coba:", err);
                    setError("Gagal menghasilkan gambar AI. Silakan periksa koneksi atau coba lagi nanti.");
                    setLoadingProductId(null);
                } else {
                    // Terapkan exponential backoff: 1s, 2s, 4s, 8s, ... + jitter
                    const delay = Math.pow(2, attempt) * 1000 + Math.random() * 500;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }
    }, [apiUrl]);

    // Komponen Kartu Produk
    const ProductCard = ({ product }) => {
        const isLoading = loadingProductId === product.id;
        const imageUrl = productImages[product.id];

        return (
            // Animasi Hover: Shadow dan Scale Transisi
            <div className="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-500 overflow-hidden group transform hover:-translate-y-1">
                <div className="h-96 overflow-hidden bg-gray-100 flex items-center justify-center">
                    {isLoading ? (
                        // Indikator Loading yang Profesional
                        <div className="w-full h-full flex items-center justify-center animate-pulse bg-gray-200">
                            <svg className="animate-spin h-8 w-8 text-red-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <p className="ml-3 text-gray-700 font-medium">Menciptakan Visual KAZA...</p>
                        </div>
                    ) : imageUrl ? (
                        // Gambar Produk
                        <img 
                            src={imageUrl} 
                            alt={product.name} 
                            // Animasi zoom saat hover
                            className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                        />
                    ) : (
                        // Placeholder Awal
                        <div className="w-full h-full flex flex-col items-center justify-center text-gray-500 bg-gray-200 p-4">
                            <svg className="w-10 h-10 mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-5 5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                            <span className="text-xl font-semibold mb-2 text-gray-700">{product.defaultText}</span>
                            <p className="text-sm text-gray-500">Klik 'Generate' untuk melihat preview AI.</p>
                        </div>
                    )}
                </div>

                <div className="p-6 text-center">
                    <h4 className="font-['Playfair_Display'] text-2xl font-semibold mb-2 text-gray-900 truncate">{product.name}</h4>
                    <p className="text-xl font-extrabold text-red-700 mb-4">{product.price}</p>
                    
                    <div className="flex flex-col space-y-3">
                        {/* Tombol Keranjang dengan efek shadow */}
                        <button 
                            className="bg-gray-800 text-white py-2 px-6 rounded-lg font-semibold shadow-md hover:bg-black transition-all duration-300 transform hover:shadow-lg"
                            onClick={() => showNotification(`${product.name} berhasil ditambahkan ke keranjang!`)}
                        >
                            Tambah ke Keranjang
                        </button>
                        {/* Tombol Generate AI */}
                        <button 
                            className={`py-2 px-6 rounded-lg font-bold text-sm transition-colors duration-300 ${
                                isLoading ? 'bg-gray-400 text-gray-700 cursor-not-allowed' : 'bg-red-100 text-red-700 hover:bg-red-200'
                            }`}
                            onClick={() => !isLoading && generateProductImage(product.id, product.prompt)}
                            disabled={isLoading}
                        >
                            {isLoading ? 'Sedang Diproses...' : 'Generate Gambar Produk (AI)'}
                        </button>
                    </div>
                </div>
            </div>
        );
    };

    // Komponen Notifikasi Pop-up
    const NotificationPopup = () => (
        <div
            className={`fixed top-5 right-5 z-50 p-4 bg-red-700 text-white rounded-lg shadow-xl transition-opacity duration-500 ${
                notification ? 'opacity-100' : 'opacity-0 pointer-events-none'
            }`}
        >
            {notification}
        </div>
    );

    // Komponen Utama Layout
    return (
        // INJEKSI CSS UNTUK ANIMASI BACKGROUND (Menggunakan style tag bawaan React)
        <>
            <style>
                {`
                /* Font custom untuk judul agar lebih profesional */
                @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap');

                @keyframes gradient-shift {
                    0% { background-position: 0% 50%; }
                    50% { background-position: 100% 50%; }
                    100% { background-position: 0% 50%; }
                }
                .animated-background {
                    /* Gradien lembut dari abu-abu terang ke krem */
                    background: linear-gradient(-45deg, #f0f0f0, #e8e8e8, #f0f0f0, #dcdcdc);
                    background-size: 400% 400%;
                    animation: gradient-shift 25s ease infinite; /* Kecepatan sedikit diperlambat */
                }
                `}
            </style>
            
            <div className="min-h-screen animated-background font-inter">
                {/* Header */}
                <header className="sticky top-0 z-10 bg-white shadow-lg">
                    <div className="container mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center py-4">
                        <h1 className="font-['Playfair_Display'] text-3xl font-bold text-gray-900 tracking-wider">KAZA</h1>
                        <nav className="flex space-x-6 mt-3 md:mt-0 items-center">
                            <a 
                                href="#" 
                                className={`text-lg font-medium transition-colors pb-1 hover:text-red-700 ${activeSection === 'home' ? 'text-red-700 border-b-2 border-red-700' : 'text-gray-700'}`}
                                onClick={() => setActiveSection('home')}
                            >
                                Beranda/Produk
                            </a>
                            <a 
                                href="#" 
                                className={`text-lg font-medium transition-colors pb-1 hover:text-red-700 ${activeSection === 'about' ? 'text-red-700 border-b-2 border-red-700' : 'text-gray-700'}`}
                                onClick={() => setActiveSection('about')}
                            >
                                Tentang Kami
                            </a>
                            {/* Kontak WA dengan logo yang jelas */}
                            <a href={waLink} target="_blank" rel="noopener noreferrer" 
                                className="text-lg font-medium py-1 px-3 rounded-full bg-green-500 text-white hover:bg-green-600 transition-colors flex items-center shadow-md">
                                <svg className="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12.002 0C6.182 0 1.5 4.682 1.5 10.5c0 1.954.542 3.844 1.57 5.513l-.99 3.61c-.13.47.013.98.375 1.344.364.364.87.506 1.342.373l3.61-.99c1.67.928 3.56 1.37 5.515 1.37C17.817 21 22.5 16.318 22.5 10.5S17.818 0 12.002 0zm0 18.818c-1.87 0-3.693-.5-5.26-1.442l-.37-.22-.38.1.37 1.35.12.44-.75.36c-1.25-.56-2.31-1.39-3.2-2.39l.23-.23.1-.38 1.35.37-.22-.37c-.94-1.565-1.44-3.388-1.44-5.26 0-5.11 4.15-9.26 9.26-9.26s9.26 4.15 9.26 9.26-4.15 9.26-9.26 9.26zm2.86-5.83c-.15-.07-.9-.45-.96-.48s-.1-.08-.14.07-.48.58-.58.69-.2.12-.37.06c-.17-.06-.72-.26-1.37-.84-.5-.45-.84-1.01-.94-1.18-.1-.17 0-.15.07-.22s.15-.17.22-.26.09-.16.07-.26-.06-.17-.26-.41c-.2-.24-.5-.6-.69-.87-.19-.26-.16-.22-.26-.23s-.2-.01-.3-.01c-.17 0-.46.06-.69.3s-.84.82-.84 2.02 1.05 2.34 1.2 2.5.38.25.61.26c.24.02.78.03 1.15-.3.37-.3.57-.7.82-1.06.25-.37.47-.63.64-.78.17-.15.35-.11.48-.04.14.07.95.48 1.08.54.14.05.24.08.26.12.02.04.02.26-.1.52-.12.26-.78.78-.9.9-.12.12-.22.18-.4.27z"/></svg>
                                WA {waNumber}
                            </a>
                            <a href="#" className="text-xl text-gray-700 hover:text-red-700 transition-colors">ðŸ›’</a>
                        </nav>
                    </div>
                </header>

                {/* Notifikasi */}
                <NotificationPopup />

                <main className="container mx-auto px-4 sm:px-6 lg:px-8 py-10">
                    {/* --- HOME SECTION --- */}
                    {activeSection === 'home' && (
                        <section id="home-section">
                            
                            {/* Hero Section dengan animasi masuk */}
                            <div className="bg-white p-12 md:p-20 rounded-2xl shadow-xl flex flex-col md:flex-row items-center justify-between my-8 animate-in fade-in slide-in-from-top-10 duration-700">
                                <div className="md:w-1/2 mb-10 md:mb-0 md:pr-10">
                                    <h2 className="font-['Playfair_Display'] text-5xl font-bold text-gray-900 mb-4 leading-tight">
                                        KOLEKSI MINIMALIS. EKSKLUSIVITAS KAZA.
                                    </h2>
                                    <p className="text-xl text-gray-600 mb-8">
                                        Jadilah yang berbeda. Temukan busana premium yang memadukan keanggunan minimalis dengan karakter KAZA yang berani.
                                    </p>
                                    <a href={waLink} target="_blank" rel="noopener noreferrer">
                                        {/* Tombol utama dengan efek 3D shadow */}
                                        <button className="bg-red-700 text-white text-lg py-3 px-8 rounded-full font-semibold shadow-red-600/50 shadow-lg hover:bg-red-800 transition-all duration-300 transform hover:scale-105">
                                            HUBUNGI KAMI VIA WA SEKARANG
                                        </button>
                                    </a>
                                </div>
                                <div className="md:w-5/12 w-full h-80 md:h-96 rounded-lg overflow-hidden shadow-2xl">
                                    {/* Placeholder Gambar Hero */}
                                    <img 
                                        src="https://placehold.co/1000x1000/2C3E50/ECF0F1?text=KAZA+Premium+Style" 
                                        alt="Koleksi Pakaian Premium KAZA" 
                                        className="w-full h-full object-cover"
                                    />
                                </div>
                            </div>

                            {/* Judul Produk */}
                            <h3 className="text-center font-['Playfair_Display'] text-4xl font-bold text-gray-900 mt-16 mb-12 animate-in fade-in duration-1000">
                                PILAHAN EKSLUSIF KAZA
                            </h3>

                            {/* Grid Produk */}
                            {error && (
                                <div className="p-4 mb-8 text-center text-red-700 bg-red-100 border border-red-300 rounded-lg animate-pulse">
                                    **ERROR API:** {error}
                                </div>
                            )}
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-10">
                                {products.map(product => (
                                    <ProductCard key={product.id} product={product} />
                                ))}
                            </div>
                        </section>
                    )}

                    {/* --- ABOUT US SECTION --- */}
                    {activeSection === 'about' && (
                        <section id="about-us-section" className="py-20 animate-in fade-in duration-700">
                            <div className="bg-white p-10 md:p-16 rounded-2xl shadow-2xl text-center">
                                <h3 className="font-['Playfair_Display'] text-5xl font-bold text-red-700 mb-8">
                                    MEMBANGUN GAYA, MENCIPTAKAN KARAKTER
                                </h3>
                                
                                <p className="text-lg text-gray-700 mb-6 max-w-3xl mx-auto">
                                    Selamat datang di KAZA. Kami bukan hanya merek pakaian; kami adalah kurator gaya hidup. Kami berdiri di atas keyakinan bahwa kualitas sejati terletak pada detail, dan fashion harus menjadi perpanjangan otentik dari diri Anda. Didirikan pada tahun 2024, KAZA bertekad untuk mendefinisikan ulang pakaian sehari-hari menjadi **karya seni yang *wearable***.
                                </p>

                                <p className="text-lg text-gray-700 mb-6 max-w-3xl mx-auto">
                                    Setiap koleksi, dari Kemeja Linen yang elegan hingga T-Shirt maskot kami yang penuh ekspresi, dibuat dengan **komitmen tanpa kompromi terhadap material dan pengerjaan**. Kami memilih kain terbaik untuk memastikan kenyamanan maksimal dan daya tahan yang melampaui tren sesaat.
                                </p>

                                <p className="text-lg text-gray-700 mb-10 max-w-3xl mx-auto font-bold">
                                    Filosofi Kami: Kami merayakan keberanian untuk menjadi sederhana namun mencolok. KAZA mengajak Anda berinvestasi pada **kualitas, bukan kuantitas**. Temukan pakaian yang akan bertahan, baik dalam lemari maupun dalam memori Anda. Bergabunglah dengan kami dalam perjalanan gaya yang berkelas dan etis.
                                </p>
                                
                                <a href={waLink} target="_blank" rel="noopener noreferrer">
                                    <button className="bg-red-700 text-white text-lg py-3 px-8 rounded-full font-semibold shadow-red-600/50 shadow-lg hover:bg-red-800 transition-all duration-300 transform hover:scale-105">
                                        HUBUNGI KAMI (WA: {waNumber})
                                    </button>
                                </a>
                            </div>
                        </section>
                    )}
                </main>

                {/* Footer yang lebih menonjol */}
                <footer className="bg-gray-900 text-white py-10 mt-10 shadow-inner">
                    <div className="container mx-auto px-4 text-center">
                        <h4 className="font-['Playfair_Display'] text-2xl font-bold mb-4">KAZA - Eksklusivitas dalam Kesederhanaan</h4>
                        <p className="text-md mb-4">Siap untuk koleksi terbaik Anda? Hubungi kami sekarang!</p>
                        
                        {/* Kontak WA yang besar di Footer */}
                        <p className="text-xl mb-6">ðŸ“ž WhatsApp: 
                            <a href={waLink} target="_blank" rel="noopener noreferrer" className="text-green-400 hover:text-green-300 font-extrabold ml-2 transition-colors underline">
                                {waNumber}
                            </a>
                        </p>
                        
                        <p className="text-xs text-gray-400">KAZA | Fashion Minimalis Berkelas. &copy; 2025 All rights reserved. | Dirancang untuk Profesionalisme.</p>
                    </div>
                </footer>
            </div>
        </>
    );
};

export default App;
